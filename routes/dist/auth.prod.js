"use strict";var express=require("express"),router=express.Router(),User=require("../models/user"),Device=require("../models/device");router.post("/login",function(e,r){var o=e.body.login,s=e.body.password;o&&s?User.findOne({login:o}).then(function(o){o&&o.password==s?(e.session.userId=o.id,e.session.userLogin=o.login,r.json({ok:!0})):r.json({ok:!1,error:"Введенные вами логин или пароль неверны!"})}).catch(function(o){console.log(o),r.json({ok:!1,error:"Такого логина не существует!"})}):r.json({ok:!1,error:"Все поля должны быть заполнены!"})}),router.post("/user",function(o,r){console.log(o.body);var e=o.body.password,s=o.body.confirm,n=o.body.phone,i=o.body.email;/^[a-zA-Z0-9]+$/.test(e)?e.length<6?r.json({ok:!1,error:"Пароль должен содержать минимум 6 символов!"}):e!=s?r.json({ok:!1,error:"Уведитесь что подтверждение пароля совпадает с самим паролем!"}):""==n||/^\+[0-9]+$/.test(n)?""==i||/^([a-z0-9_-]+\.)*[a-z0-9_-]+@[a-z0-9_-]+(\.[a-z0-9_-]+)*\.[a-z]{2,6}$/.test(i)?User.updateOne({login:o.session.userLogin},{$set:{password:e,phone:n,email:i}},function(o,e){console.log(e),r.json({ok:!0,mess:"Данные успешно обновлены!"})}):r.json({ok:!1,error:"Проверьте правильность ввода электронной почты!"}):r.json({ok:!1,error:"Номер телефона может содержать только цифры!"}):r.json({ok:!1,error:"Только латинские буквы и цифры!"})}),router.post("/add",function(o,e){var r=o.body.name,s=o.body.type,n=o.body.room;r&&s&&n?Device.create({login:r,userLogin:o.session.userLogin,room:n,type:s,condition:"0"}).then(function(o){console.log(o.id)}):e.json({ok:!1,error:"Все поля должны быть заполнены!"})}),module.exports=router;